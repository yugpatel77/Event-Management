{% extends 'base.html' %}
{% load static %}

{% block title %}Chat | 360Â° Event Manager{% endblock %}

{% block content %}
<div class="page-container" style="display:flex;gap:2rem;min-height:70vh;">
  <!-- Left: Recent Chats -->
  <div class="chat-inbox shadow" style="width:350px;min-width:300px;max-width:400px;">
    <h4 class="mb-2">Recent Chats</h4>
    <div>
      <div class="text-muted mb-1">Private</div>
      {% for conv in conversations %}
      <a href="{% url 'communications:chat_room' conv.id %}" class="chat-list-item flex {% if conv.unread_count %}active{% endif %}">
        <div class="chat-avatar">{{ conv.participant1|default:conv.participant2|slice:':1'|upper }}</div>
        <div>
          <div class="fw-bold">{% if conv.participant1 == user %}{{ conv.participant2.get_full_name|default:conv.participant2.username }}{% else %}{{ conv.participant1.get_full_name|default:conv.participant1.username }}{% endif %}</div>
          <div class="last-message">{{ conv.messages.last.content|truncatewords:10 }}</div>
        </div>
        {% if conv.unread_count %}<span class="unread-badge">{{ conv.unread_count }}</span>{% endif %}
      </a>
      {% empty %}
      <div class="text-muted text-center" style="padding:2.5em 0;">
        <i class="fa fa-user-friends fa-2x mb-2"></i><br>
        <span>No private chats yet. Start a conversation!</span>
      </div>
      {% endfor %}
      <div class="text-muted mt-2 mb-1">Groups</div>
      {% for room in group_chats %}
      <a href="{% url 'communications:group_chat_room' room.id %}" class="chat-list-item flex {% if room.unread_count %}active{% endif %}">
        <div class="chat-avatar"><i class="fa fa-users"></i></div>
        <div>
          <div class="fw-bold">{{ room.name }}</div>
          <div class="last-message">{{ room.last_message.content|truncatewords:10 }}</div>
        </div>
        {% if room.unread_count %}<span class="unread-badge">{{ room.unread_count }}</span>{% endif %}
      </a>
      {% empty %}
      <div class="text-muted text-center" style="padding:2.5em 0;">
        <i class="fa fa-users fa-2x mb-2"></i><br>
        <span>No group chats yet. Join or create a group!</span>
      </div>
      {% endfor %}
    </div>
    <div class="mt-3 text-center">
      <a href="{% url 'communications:create_chat' %}" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i> New Chat</a>
      <a href="{% url 'communications:group_join_requests' %}" class="btn btn-secondary btn-sm ms-2"><i class="fa fa-user-plus"></i> Join Requests</a>
    </div>
  </div>
  <!-- Right: Ongoing Chat (loaded by navigation) -->
  <div id="chat-panel" style="flex:1;min-width:0;">
    <div class="text-center text-muted" style="margin-top:30vh;">
      <i class="fa fa-comments fa-3x mb-2"></i>
      <div>Select a chat to start messaging</div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.chat-bg {
  background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
  min-height: 100vh;
}
.glass-card {
  padding: 2rem 1.5rem;
  border-radius: 24px;
  box-shadow: 0 8px 32px rgba(30,58,138,0.13);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255,255,255,0.18);
}
.list-group-item {
  background: rgba(255,255,255,0.10);
  border: none;
  border-radius: 16px;
  margin-bottom: 0.5rem;
  transition: background 0.2s;
}
.list-group-item:hover {
  background: rgba(59,130,246,0.13);
}
.badge.bg-danger {
  font-size: 0.9em;
  padding: 0.4em 0.7em;
}
@media (max-width: 600px) {
  .glass-card { padding: 1rem 0.5rem; }
}
.chat-inbox {
  background: #fff;
  border-radius: 18px;
  padding: 1.5rem 1rem;
  box-shadow: 0 4px 24px rgba(30,58,138,0.10);
  min-height: 70vh;
}
.chat-list-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.7rem 0.5rem;
  border-radius: 12px;
  margin-bottom: 0.3rem;
  text-decoration: none;
  color: #222;
  transition: background 0.18s;
  position: relative;
}
.chat-list-item.active, .chat-list-item:hover {
  background: #e0e7ff;
}
.chat-avatar {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  background: #3b82f6;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  font-weight: 600;
  box-shadow: 0 2px 8px rgba(59,130,246,0.10);
}
.unread-badge {
  background: #ef4444;
  color: #fff;
  font-size: 0.85em;
  font-weight: 600;
  border-radius: 12px;
  padding: 0.2em 0.7em;
  margin-left: auto;
  margin-right: 0.2em;
  box-shadow: 0 1px 4px rgba(239,68,68,0.10);
}
.last-message {
  font-size: 0.97em;
  color: #6b7280;
  margin-top: 0.1em;
  max-width: 180px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
@media (max-width: 600px) {
  .chat-inbox { min-width: 0; width: 100%; padding: 1rem 0.3rem; }
  .chat-list-item { gap: 0.5rem; }
  .chat-avatar { width: 32px; height: 32px; font-size: 1rem; }
}
</style>
{% endblock %} 